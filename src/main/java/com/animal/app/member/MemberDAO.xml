<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- namespace의 이름은 사용하려는 DAO의 풀패키지명과 동일하게 작성 -->
  <mapper namespace="com.animal.app.member.MemberDAO">
  	<resultMap type="MemberVO" id="loginResult">
  		<id column="MEMBER_NO" property="memberNo"/>
  		<result column="MEMBER_ID" property="memberId"/>
  		<result column="MEMBER_PASSWORD" property="memberPassword"/>
  		<result column="MEMBER_PHONE" property="memberPhone"/>
  		<result column="MEMBER_EMAIL" property="memberEmail"/>
  		<result column="MEMBER_NAME" property="memberName"/>
  		<result column="MEMBER_ROLE" property="memberRole"/>
  		
  		<association property="profileVO" javaType="ProfileVO">
  			<result column="ORI_NAME" property="oriName"/>
  			<result column="SAVE_NAME" property="saveName"/>
  		</association>
  	
  	</resultMap>
  
  
	<!-- Join(회원가입) -->
	<insert id="join" parameterType="MemberVO" useGeneratedKeys="true" keyProperty="memberNo" keyColumn="MEMBER_NO">
	 	INSERT INTO MEMBER
	 	VALUES (null, #{memberId}, #{memberPassword}, #{memberPhone}, #{memberEmail}, #{memberName}, #{memberRole} )
	 </insert> 
	 
	 
	 <!-- 프로필 insert -->
	 <insert id="profileInsert" parameterType="ProfileVO">
	 	INSERT INTO MEMBER_PROFILE
	 	VALUES (#{memberNo}, #{oriName}, #{saveName})
	 </insert>
	 
	 <!-- 권한 업데이트 (addRole) -->
  <update id="addRole" parameterType="map">
    UPDATE MEMBER
       SET MEMBER_ROLE = #{memberRole}
     WHERE MEMBER_ID   = #{memberId}
  </update>
	
	<!-- Login(로그인) -->
	  <select id="login" parameterType="MemberVO" resultMap="loginResult">
        SELECT 
            M.MEMBER_NO, M.MEMBER_ID, M.MEMBER_PASSWORD, M.MEMBER_PHONE, M.MEMBER_EMAIL, M.MEMBER_NAME, M.MEMBER_ROLE,
            P.ORI_NAME, P.SAVE_NAME
        FROM 
            MEMBER M
        LEFT JOIN 
            MEMBER_PROFILE P ON M.MEMBER_NO
             = P.MEMBER_NO
        WHERE 
            M.MEMBER_ID = #{memberId}
    </select>

	<!-- Update(정보 수정) -->
	<update id="update" parameterType="MemberVO">
		UPDATE MEMBER
		SET MEMBER_NAME = #{memberName}, MEMBER_PHONE = #{memberPhone}, MEMBER_EMAIL = #{memberEmail}
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	<!-- updateProfile(프로필 수정) -->
	<update id="updateProfile" parameterType="ProfileVO">
		UPDATE MEMBER_PROFILE
		SET SAVE_NAME = #{saveName}, ORI_NAME = #{oriName}
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	
	<!-- Detail(회원 상세) -->
	<select id="detail" parameterType="long" resultType="MemberVO">
		SELECT M.MEMBER_NO, M.MEMBER_ID, M.MEMBER_PASSWORD, M.MEMBER_NAME, M.MEMBER_PHONE, M.MEMBER_EMAIL,
           P.SAVE_NAME AS "profileVO.saveName",
           P.ORI_NAME  AS "profileVO.oriName"
	    FROM MEMBER M
	    LEFT JOIN MEMBER_PROFILE P ON M.MEMBER_NO = P.MEMBER_NO
	    WHERE M.MEMBER_NO = #{memberNo}
	</select>
	

  </mapper>
