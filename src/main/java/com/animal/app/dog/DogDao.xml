<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.animal.app.dog.DogDao">
	<resultMap type="DogVO" id="resultDog">
		<id column="DOG_NO" property="dogNo" />
		<result column="DOG_NAME" property="dogName" />
		<result column="DOG_BIRTH" property="dogBirth" />
		<result column="DOG_GENDER" property="dogGender" />
		<result column="DOG_TYPE" property="dogType" />
		<result column="DOG_ACTIVE" property="dogActive" />
		<result column="DOG_INOCULATION" property="dogInoculation" />
		<result column="DOG_PRICE" property="dogPrice" />
		<result column="DOG_INFO" property="dogInfo" />
		<association property="dogFileVO" javaType="FileVO">
			<result column="ORI_NAME" property="oriName" />
			<result column="SAVE_NAME" property="saveName" />
		</association>
	</resultMap>
	<select id="list" resultType="DogVO">
		SELECT * FROM DOG
		WHERE DOG_ACTIVE=TRUE
		ORDER BY DOG_NO DESC
	</select>
	<insert id="insert" parameterType="DogVO"
		useGeneratedKeys="true" keyProperty="dogNo">
		INSERT INTO dog
		VALUES(null,#{dogName},#{dogBirth},#{dogGender},#{dogType},true
		,#{dogInoculation},#{dogPrice},#{dogInfo})

	</insert>
	<insert id="insertFile" parameterType="java.util.Map">
		INSERT INTO DOG_PROFILE
		VALUES(#{dogNo},#{oriName},#{saveName})

	</insert>
	<select id="detail" parameterType="dogVO" resultMap="resultDog">
		SELECT *
		from DOG
		NATURAL JOIN DOG_PROFILE
		WHERE DOG_NO =#{dogNo}
		
	</select>
	<select id="cartList" parameterType="MemberVO"
		resultMap="resultDog">
		SELECT * FROM DOG
		NATURAL JOIN FAVARITES
		NATURAL JOIN MEMBER
		NATURAL JOIN DOG_PROFILE
		WHERE MEMBER_NO=#{memberNo}
			  AND DOG_ACTIVE=TRUE
		ORDER BY DOG_NO DESC
	</select>
	<insert id="cartAdd" parameterType="java.util.Map">
		INSERT INTO FAVARITES
		VALUES
		(#{memberNo},#{dogNo})

	</insert>
	<delete id="cartDelete" parameterType="java.util.Map">
		DELETE FROM FAVARITES
		<where>
			MEMBER_NO = #{memberNo}
			AND DOG_NO IN
			<foreach collection="dogNo" item="l" open="(" separator=","
				close=")">
				#{l}
			</foreach>
		</where>


	</delete>
	
	<update id="delete" parameterType="long">
		UPDATE DOG
		SET DOG_ACTIVE =FALSE
		WHERE DOG_NO =#{value}
	</update>
	
	<insert id ="adoptLog" parameterType="java.util.Map">
		INSERT INTO ADOPTIONLOG
		VALUES(null,#{dogNo},#{memberNo})
		
	
	</insert>
</mapper>